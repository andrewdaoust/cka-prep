"use strict";(self.webpackChunkcka_prep_2=self.webpackChunkcka_prep_2||[]).push([[4239],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),h=c(n),d=r,m=h["".concat(l,".").concat(d)]||h[d]||u[d]||o;return n?a.createElement(m,s(s({ref:t},p),{},{components:n})):a.createElement(m,s({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6365:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return h}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),s=["components"],i={id:"chapter02",title:"Basics of Kubernetes"},l=void 0,c={unversionedId:"fundamentals/chapter02",id:"fundamentals/chapter02",title:"Basics of Kubernetes",description:"Course Reading",source:"@site/docs/fundamentals/chapter02.md",sourceDirName:"fundamentals",slug:"/fundamentals/chapter02",permalink:"/cka-prep/docs/fundamentals/chapter02",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/fundamentals/chapter02.md",tags:[],version:"current",frontMatter:{id:"chapter02",title:"Basics of Kubernetes"},sidebar:"tutorialSidebar",previous:{title:"Course Introduction",permalink:"/cka-prep/docs/fundamentals/chapter01"},next:{title:"Installation and Configuration",permalink:"/cka-prep/docs/fundamentals/chapter03"}},p=[{value:"Course Reading",id:"course-reading",children:[{value:"Learning objectives",id:"learning-objectives",children:[],level:3},{value:"What is Kubernetes",id:"what-is-kubernetes",children:[],level:3},{value:"Components of Kubernetes",id:"components-of-kubernetes",children:[],level:3},{value:"Challenges",id:"challenges",children:[],level:3},{value:"Other solutions",id:"other-solutions",children:[],level:3},{value:"Borg Heritage",id:"borg-heritage",children:[],level:3},{value:"Kubernetes architecture",id:"kubernetes-architecture",children:[],level:3},{value:"Terminology",id:"terminology",children:[],level:3},{value:"Innovation",id:"innovation",children:[],level:3},{value:"User Community",id:"user-community",children:[],level:3},{value:"Tools",id:"tools",children:[],level:3},{value:"Cloud Native Computing Foundation",id:"cloud-native-computing-foundation",children:[],level:3}],level:2},{value:"Lab 2.1 - View Online Resources",id:"lab-21---view-online-resources",children:[],level:2},{value:"Knowledge check",id:"knowledge-check",children:[],level:2}],u={toc:p};function h(e){var t=e.components,i=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"course-reading"},"Course Reading"),(0,o.kt)("h3",{id:"learning-objectives"},"Learning objectives"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Basic terminology"),(0,o.kt)("li",{parentName:"ul"},"Configuration tools"),(0,o.kt)("li",{parentName:"ul"},"Community resources")),(0,o.kt)("h3",{id:"what-is-kubernetes"},"What is Kubernetes"),(0,o.kt)("p",null,"Running a single container is easy, but when trying to connect multiple containers with networking, scaling them, and deploying changes without downtime, it becomes a more difficult problem.  Kubernetes is a system to automate the deployment, scaling, and management of containerized applications. "),(0,o.kt)("p",null,"The name is derived from the Greek ",(0,o.kt)("strong",{parentName:"p"},"\u03ba\u03c5\u03b2\u03b5\u03c1\u03bd\u03b7\u03c4\u03b7\u03c2"),", which means helmsman or ship pilot.  Kubernetes is often referred to as K8s, with the 8 representing the 8 letters between ",(0,o.kt)("em",{parentName:"p"},"k")," and ",(0,o.kt)("em",{parentName:"p"},"s"),"."),(0,o.kt)("h3",{id:"components-of-kubernetes"},"Components of Kubernetes"),(0,o.kt)("p",null,"Instead of deploying your application monolithically on a web server that potentially needs to ever grow to handle load, Kubernetes uses many small servers (microservices).  Because K8s is architected around microservices, server and client side applications expect there are many agents that could respond to a request and that each agent is transient, being destroyed and replaced as needed.  "),(0,o.kt)("p",null,"Because of the transient nature, this allows different parts of the application to be decoupled.  Communication between services is API call-driven.  The configuration of the cluster is stored as JSON inside etcd, however most is the community write it as YAML, where K8s then converts it to JSON before storing it."),(0,o.kt)("p",null,"Kubernetes is written in Golang (unsurprising since it is an open source project originating from Google)."),(0,o.kt)("h3",{id:"challenges"},"Challenges"),(0,o.kt)("p",null,"As mentioned previously, containers make it easy to package, ship, and run an application.  Docker especially has vastly improved the developer experience in these regards."),(0,o.kt)("p",null,"However, there are many challenges that appear when running and maintaining containers at scale.  To help with the maintenance, it is good practice to implement a continuous integration/continuous delivery (CI/CD) pipeline to make build, test and verify changes to containers. Some common tools for CI/CD include:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://spinnaker.io/"},"Spinnaker")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.jenkins.io/"},"Jenkins")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://helm.sh/"},"Helm"))),(0,o.kt)("p",null,"There are many requirements when trying to run containers at scale.  First of all you need base infrastructure to run the containers. On top of that you need a way to launch the containers, replace them on failure, tear them down when no longer needed, and be able to rollout or rollback updates easily.  On top of that, all these actions need networking and storage that is just as flexible, scalable, and easy-to-use.  "),(0,o.kt)("p",null,"Kubernetes solves all these problems, however the biggest problem is usually the application architecture itself.  The application needs to truly be architected to be transient. Something to ponder: if ",(0,o.kt)("em",{parentName:"p"},"any")," container were to be terminated, would that impact your application?"),(0,o.kt)("h3",{id:"other-solutions"},"Other solutions"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/swarm/"},"Docker Swarm")," - created by Docker Inc. Built right into the Docker engine"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mesos.apache.org/"},"Apache Mesos")," - is a powerful scheduler.  Orchestrates containers with a framework called ",(0,o.kt)("a",{parentName:"li",href:"https://mesosphere.github.io/marathon/"},"Marathon")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.nomadproject.io/"},"Nomad")," - developed by HashiCorp. Nomad schedules tasks and has a Docker driver which allows for containers to be scheduled as a task."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://rancher.com/"},"Rancher")," - orchestrator agnostic system to manage applications. Works on top of Mesos, Swarm, and Kubernetes.")),(0,o.kt)("h3",{id:"borg-heritage"},"Borg Heritage"),(0,o.kt)("p",null,"One of the primary factors that distinguish Kubernetes from some of the other systems mentioned is the heritage of the project.  K8s was born out of Borg, Google's internal system to manage its applications."),(0,o.kt)("p",null,"This is partially what makes K8s a safe choice, as it was born from 15 years of internal development at Google to handle their data center workloads.  More notes on the ideas that inspired Kubernetes can be found ",(0,o.kt)("a",{parentName:"p",href:"../misc/borg"},"here"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Kubernetes lineage",src:n(2512).Z,width:"638",height:"359"})),(0,o.kt)("p",null,"Borg has inspired many data center orchestration systems.  Google contributed ",(0,o.kt)("inlineCode",{parentName:"p"},"cgroups")," to the Linux kernel in 2007, which along with Linux namespaces, form the heart of containerization today.  Mesos was inspired by discussions with Google."),(0,o.kt)("p",null,"The Cloud Foundry Foundation embraces the ",(0,o.kt)("a",{parentName:"p",href:"https://12factor.net/"},"12 factor application principles")," which Kubernetes and Borg adhere to well."),(0,o.kt)("h3",{id:"kubernetes-architecture"},"Kubernetes architecture"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Kubernetes architecture",src:n(8361).Z,width:"728",height:"361"})),(0,o.kt)("p",null,"Kubernetes is made of control plane (aka ",(0,o.kt)("strong",{parentName:"p"},"cp"),") nodes and worker nodes (formerly called minions). It is possible to run everything on one node for testing purposes.  The cp nodes are in charge of the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"API server"),(0,o.kt)("li",{parentName:"ul"},"scheduler"),(0,o.kt)("li",{parentName:"ul"},"various controllers"),(0,o.kt)("li",{parentName:"ul"},"storage system (contains cluster state, container settings, network config)")),(0,o.kt)("p",null,"The Kubernetes API is exposed via the API server.  ",(0,o.kt)("inlineCode",{parentName:"p"},"kubectl")," is the most common way to interact with the API but users can develop their own clients using ",(0,o.kt)("inlineCode",{parentName:"p"},"curl")," commands."),(0,o.kt)("p",null,"The kube-scheduler receives the pod spec for containers and finds the best node to them.  Each node has two processes, a kubelet and the kube-proxy.  The kubelet is NOT the container itself, but often a ",(0,o.kt)("inlineCode",{parentName:"p"},"systemd")," process.  The kubelet is responsible for taking requests to run containers, managing the nodes resources. The kubelet also works with the container engine (e.g. containerd, Docker, cri-o) to run the containers."),(0,o.kt)("p",null,"The kube-proxy manages all the networking rules to expose the containers either to other containers or to external traffic."),(0,o.kt)("p",null,"One implication of API based communication means worker nodes can run on other platforms, however the cp must run on a Linux system."),(0,o.kt)("h3",{id:"terminology"},"Terminology"),(0,o.kt)("p",null,"A ",(0,o.kt)("strong",{parentName:"p"},"pod")," is the smallest deployable unit in Kubernetes.  A pod is one or more containers that share an IP address, storage, and namespace.  Pods can be just one container, or  multiple. When multiple, typically one container is running the application while the others support the primary.  By allowing multiple containers in a pod, this allows for tightly couple groups on containers to be deployed as a unit, making it more efficient for them to communicate and share data.  This also allows for keeping with good development practices of only allowing one process per container, rather than having to bundle all the functionality of the containers running in a pod into a single container."),(0,o.kt)("p",null,"Kubernetes uses ",(0,o.kt)("strong",{parentName:"p"},"namespaces")," to partition objects for resourcing and multi-tenancy.  Some objects will be scoped to the cluster, while others will only be scoped to one at a time.  Since namespaces segregate resources, pods would need to leverage services to communicate with one another."),(0,o.kt)("p",null,"Controller or ",(0,o.kt)("strong",{parentName:"p"},"operators")," manage the orchestration of the pods through watch-loops.  The ",(0,o.kt)("strong",{parentName:"p"},"kube-apiserver")," is interrogated by each operator for object states and modify the objects until the declared state from the API matches the current state of the object.  The operators are compiled within the ",(0,o.kt)("strong",{parentName:"p"},"kube-controller-manager")," and others can be added through custom resource definitions.  The default operator for a container is a ",(0,o.kt)("strong",{parentName:"p"},"Deployment"),".  The Deployment manages ReplicaSets not the pods directly.  A ",(0,o.kt)("strong",{parentName:"p"},"ReplicaSet")," is another operator which creates and terminates pods according to the podSpec.  The kubelet reads the podSpec and works with the container engine to download any resources then create or terminate containers until the status defined by the podSpec is met."),(0,o.kt)("p",null,"Service operator will request IP information from the endpoint operator, and then manages network connectivity based on labels on pods.  A service is used for establishing communication between pods, namespaces, and external sources.  ",(0,o.kt)("strong",{parentName:"p"},"Jobs")," and ",(0,o.kt)("strong",{parentName:"p"},"CronJobs")," handle single or repeated tasks.  There are other default operators as well."),(0,o.kt)("p",null,"To make management of pods easier (especially when scaling to thousands of pods across hundreds of nodes), ",(0,o.kt)("strong",{parentName:"p"},"labels")," are used.  Labels are just strings included in metadata which can be used for checking or changing state so needing to know individual names or UIDs isn't necessary.  Nodes can have ",(0,o.kt)("strong",{parentName:"p"},"taints")," to discourage pod assignments, unless the pod metadata contains ",(0,o.kt)("strong",{parentName:"p"},"toleration")," (more on those topics ",(0,o.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/"},"here"),")."),(0,o.kt)("p",null,"Metadata also can contain ",(0,o.kt)("strong",{parentName:"p"},"annotations")," which are part of the object but are not used as a selector like labels.  The info in the annotations can be used by a variety of sources, like the container, by third-parties, or other tools."),(0,o.kt)("h3",{id:"innovation"},"Innovation"),(0,o.kt)("p",null,"Kubernetes is a fast moving open source project."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Open sourced in 2014"),(0,o.kt)("li",{parentName:"ul"},"3 month release cycle for major releases"),(0,o.kt)("li",{parentName:"ul"},"Minor released every 10 days"),(0,o.kt)("li",{parentName:"ul"},"100k+ commits from thousands of contributors")),(0,o.kt)("h3",{id:"user-community"},"User Community"),(0,o.kt)("p",null,"Kubernetes has been quickly adopted. They list some good ",(0,o.kt)("a",{parentName:"p",href:"https://kubernetes.io/case-studies/"},"case studies")," on their site."),(0,o.kt)("h3",{id:"tools"},"Tools"),(0,o.kt)("p",null,"There are many tools for getting up and running and interacting with Kubernetes.  One of the simplest is ",(0,o.kt)("a",{parentName:"p",href:"https://minikube.sigs.k8s.io/docs/"},(0,o.kt)("strong",{parentName:"a"},"Minikube"))," if you want to get started as easily as possible.  The labs in this course will focus in using ",(0,o.kt)("inlineCode",{parentName:"p"},"kubectl")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"kubeadm"),", which are much more complex and powerful.  Later labs will also focus on using ",(0,o.kt)("inlineCode",{parentName:"p"},"helm")," which acts as a package manager for Kubernetes.  These tools develop just as fast as Kubernetes itself!"),(0,o.kt)("h3",{id:"cloud-native-computing-foundation"},"Cloud Native Computing Foundation"),(0,o.kt)("p",null,"Google donated Kubernetes to a newly formed Cloud Native Computing Foundation to open source and steward the project. CNCF has grown to govern other ",(0,o.kt)("a",{parentName:"p",href:"https://www.cncf.io/projects/"},"open source projects")," in the cloud native space."),(0,o.kt)("h2",{id:"lab-21---view-online-resources"},"Lab 2.1 - View Online Resources"),(0,o.kt)("p",null,"Official documentation and other resources can be found at ",(0,o.kt)("a",{parentName:"p",href:"https://kubernetes.io/"},"kubernetes.io"),"."),(0,o.kt)("p",null,"Issues with Kubernetes are tracked in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes/issues"},"project Github repo"),"."),(0,o.kt)("h2",{id:"knowledge-check"},"Knowledge check"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"One or multiple containers"),", ",(0,o.kt)("em",{parentName:"p"},"shared IP address"),", and a ",(0,o.kt)("em",{parentName:"p"},"single namespace")," are all part of a Pod."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Google")," developed Borg as an internal project (the precursor to Kubernetes)."),(0,o.kt)("p",null,"Object and state of the cluster are stored in the ",(0,o.kt)("em",{parentName:"p"},"etcd")," database."),(0,o.kt)("p",null,"Orchestration is managed through a series of watch-loops or controllers. Each interrogates the ",(0,o.kt)("em",{parentName:"p"},"kube-apiserver")," for a particular object state."))}h.isMDXComponent=!0},8361:function(e,t,n){t.Z=n.p+"assets/images/ch02-architecture-ba5de9e7fccd10f83d78db1eb58862db.png"},2512:function(e,t,n){t.Z=n.p+"assets/images/ch02-k8s-lineage-527af48fa1d9f74272a1e5170d7dba96.jpg"}}]);