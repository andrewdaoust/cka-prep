<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Security | CKA Prep</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter15"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Security | CKA Prep"><meta data-react-helmet="true" name="description" content="Course Reading"><meta data-react-helmet="true" property="og:description" content="Course Reading"><link data-react-helmet="true" rel="icon" href="/cka-prep/img/k8s.png"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter15"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter15" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter15" hreflang="x-default"><link rel="stylesheet" href="/cka-prep/assets/css/styles.e68b4784.css">
<link rel="preload" href="/cka-prep/assets/js/runtime~main.d35ec206.js" as="script">
<link rel="preload" href="/cka-prep/assets/js/main.57502370.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cka-prep/"><div class="navbar__logo"><img src="/cka-prep/img/kubernetes-icon.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/cka-prep/img/kubernetes-icon.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">CKA Prep</b></a><a class="navbar__item navbar__link navbar__link--active" href="/cka-prep/docs/intro">Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/andrewdaoust/cka-prep" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cka-prep/docs/intro">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/cka-prep/docs/fundamentals">Kubernetes Fundamentals</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes Fundamentals&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter01">Course Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter02">Basics of Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter03">Installation and Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter04">Kubernetes Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter05">APIs and Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter06">API Objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter07">Managing State with Deployments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter08">Volumes and Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter09">Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter10">Helm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter11">Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter12">Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter13">Logging and Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter14">Custom Resource Definitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cka-prep/docs/fundamentals/chapter15">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter16">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter17">Exam Domain Review</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/follow-up">Follow-up Items</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/cka-prep/docs/kubectl/setup">kubectl</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/cka-prep/docs/hard-way/about">Kubernetes the Hard Way</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/cka-prep/docs/linux">Linux</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/cka-prep/docs/misc">Miscellaneous Topics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellaneous Topics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Security</h1></header><h2 id="course-reading">Course Reading</h2><h3 id="learning-objectives">Learning objectives</h3><ul><li>Explain the flow of API requests</li><li>Configure authorization rules</li><li>Examine authentication policies</li><li>Use network policies to restrict traffic</li></ul><h3 id="overview">Overview</h3><p>Security is a very broad and complex topic, this section will cover it as it relates to Kubernetes specifically.</p><p>This will include the following topics:</p><ul><li>Authentication and authorization with the API server</li><li>RBAC</li><li>The admission control system</li><li>Securing pods more tightly with security contexts and security policies</li><li>Network policies</li></ul><h3 id="cloud-security-considerations">Cloud security considerations</h3><p>When running Kubernetes in the cloud (or any other software for that matter), the first consideration is to ensure the hardware, firmware, and OS you are running on are secure and hardened.  Once this is ensured, you can start securing the software itself.  In Kubernetes, the first thing that should be secured is the kube-apiserver, which has a list of considerations, tools, and settings to limit and control the access to it.</p><p>Since Kubernetes is a network heavy runtime, securing the network inside the cluster, like with a NetworkPolicy, and outside tools like firewalls is important.</p><p>The next layer of security is the application level. The applications run inside Kubernetes should be secured through means of minimizing base images used, container immutability, and through the use of static/runtime analysis tools.  These steps are often done during the development process or when building the CI/CD pipeline.  Things like AppArmor and SELinux should be used to further protect an environment from malicious containers.</p><p>It is also important to continually be checking for vulnerabilities. Security is not just getting the settings and configuration right on the first deployment.</p><h3 id="accessing-the-api">Accessing the API</h3><p>Any action performed in a Kubernetes cluster must go through the API. Each request to the API goes through 3 main steps:</p><ul><li>Authentication (token)</li><li>Authorization (RBAC)</li><li>Admission controller</li></ul><p>When the API receives a request, the authentication step is first by going through whatever the configured authentication module is.  If authentication fails, then the request is rejected.  If it succeeds, then the request is passed to the authorization step.</p><p>The authorization step checks the request against existing policies. If the user has the correct permissions to perform the requested action, the request will then pass to admission. If not the request is rejected at this step.</p><p>Finally, the admission step is generally responsible for the validation in the content of the request. If validation succeeds, then the request succeeds.</p><p>Additionally, the request is received encrypted using TLS.  When creating a cluster with <code>kubeadm</code> this is done manually.  You can learn more about how the API server is configured <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/">here</a>. More about access control in Kubernetes can be learned in the docs <a href="https://kubernetes.io/docs/concepts/security/controlling-access/">here</a>.</p><h3 id="authentication">Authentication</h3><p>There are 3 things to remember when it comes to auth in Kubernetes.</p><ul><li>Auth is done with certificates, tokens, or username/password (in it&#x27;s most basic form)</li><li>Users aren&#x27;t created by the API and should be managed elsewhere externally</li><li>Processes use system accounts to access the API (more on that <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">here</a>)</li></ul><p>Additionally there are two other advanced auth methods, webhooks to verify a bearer token, and with external OpenID providers.</p><p>The type of authentication used is determined to by the kube-apiservers startup options.  Here are some examples of startup options that can be used.</p><ul><li><code>--basic-auth-file</code></li><li><code>--oidc-issuer-url</code></li><li><code>--token-auth-file</code></li><li><code>--authorization-webhook-config-file</code></li></ul><p>More than one authentication module can be used.  Module options are:</p><ul><li>x509 client certs</li><li>static, bearer, or bootstrap tokens</li><li>static password file</li><li>service account</li><li>OpenID connect token</li></ul><p>Each module in use is tried until successful, and the order is not guaranteed.  Anonymous access is also available to be enabled, otherwise a 401 response is returned.</p><p>More info about Kubernetes authentication can be <a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/">found in the docs</a>.</p><h3 id="authorization">Authorization</h3><p>There are two main modes of authorization, RBAC and webhooks.  These are also configured using kube-apiserver startup options.  Some examples are:</p><ul><li><code>--authorization-mode=RBAC</code></li><li><code>--authorization-mode=Webhook</code></li><li><code>--authorization-mode=AlwaysDeny</code></li><li><code>--authorization-mode=AlwaysAllow</code></li></ul><p>The different authorization modes implement policies.  Request attributes are then checked against the policies.</p><h3 id="rbac-and-webhook-modes">RBAC and webhook modes</h3><h4 id="rbac">RBAC</h4><p>RBAC is short for Role Based Access Control.</p><p>All objects you can create in Kubernetes are modelled in the API and each object belongs to some group.  The resources allow for standard CRUD operations.  In Kubernetes YAML manifests, these operations are called <strong>verbs</strong>.  </p><p>On top of these basic operations are rules, which act upon API groups, and roles are made up of sets or rules.  These roles scope a single namespace, or with <code>ClusterRoles</code> give scope across the entire cluster.</p><p>These operations act on 1 or 3 subjects, user accounts (these are not API objects), service accounts, and groups (know as <code>clusterrolebinding</code> in <code>kubectl</code>).  RBAC then writes rules to allow or deny the requested operation by the user, role, or group.</p><p>RBAC is complex but the basic flow is as follows:</p><ul><li>Determine/create namespace</li><li>Create a cert for the user against the cluster CA. Since users aren&#x27;t API objects outside auth is required, such as OpenSSL certs.</li><li>Set credential for the user to the namespace using a context</li><li>Create a role for the expected tasks</li><li>Bind the user to the role</li><li>Verify user has limited access</li></ul><p>Learn more about RBAC in the <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">official docs</a>.</p><h4 id="webhook">Webhook</h4><p>Webhooks are HTTP callbacks, usually a POST request that occurs when something happens to act as an event-notification.  Web applications that implement webhooks send POST requests to a URL when certain events occur.</p><p>More about Kubernetes&#x27; webhooks mode can be found in the <a href="https://kubernetes.io/docs/reference/access-authn-authz/webhook/">official docs</a>.</p><h3 id="admission-controller">Admission controller</h3><p>The final step for allowing an API request is admission control.</p><p>An admission controller is software that has access to the content of the objects being requested. They will modify or validate this content and are the last layer that can deny the request.</p><p>Starting in v1.13 of the kube-apiserver, admission controllers are compiled into the binary, instead of a list passed during execution.Admissions controllers are now needed for certain features to work and is not consider a mature feature.  To enable or disable certain admission controller plugins, you can pass startup options to the kube-apiserver.  Some examples:</p><ul><li><code>--enable-admission-plugins=Initializers,NamespaceLifecycle,LimitRanger</code></li><li><code>--disable-admission-plugins=PodNodeSelector</code></li></ul><p>Change the names of the plugins you want to enable and disable.</p><p>You can learn more about each of the admission controllers and what they do in the <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#what-does-each-admission-controller-do">official docs</a>.</p><h3 id="security-contexts">Security contexts</h3><p>You can set security limitations on pods using what is called a security context.  These can be defined at the pod or container level as part of the manifest for the resource.</p><p>Some examples of what you may use this for are </p><ul><li>limit UID of a process</li><li>limit Linux capabilities</li><li>filesystem group limitations</li></ul><p>Another example would be preventing a process from running as the root user. The definition of a Pod using this security context would look something like the following.</p><pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  securityContext:
    runAsNonRoot: true
  containers:
  - image: nginx
    name: nginx
</code></pre><p>When you try to deploy this pod to the cluster, it would fail and never become ready since <code>nginx</code> runs as the root user, but the security context would prevent this.</p><p>More about configuring security contexts can be found in the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/">official docs</a>.</p><h3 id="pod-security-policies">Pod security policies</h3><p>Pod security policies (PSPs) automate the enforcement of security contexts.  A PSP is defined as a standard Kubernetes manifest like any other standard API object.  The policies are cluster level and govern what pods can do (including access permissions, what users to run as, etc).</p><p>Similar to the example in the <a href="#security-contexts">security contexts section</a>, if you wanted to make sure all pods are not able to run as root, the you could define a PSP to enforce this.</p><pre><code class="language-yaml">apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: restricted
spec:
  seLinux:
    rule: RunAsAny
  supplementalGroups:
    rule: RunAsAny
  runAsUser:
    rule: MustRunAsNonRoot
  fsGroup:
    rule: RunAsAny
</code></pre><p>For PSPs to be enabled, their associated admission controller plugin must be configured. These pair well with RBAC configuration to fine tune what users are allowed to run and the low level permissions their containers will have.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>PSPs have been depreciated in v1.25 and their replacement, Pod Security Admission is in alpha</p></div></div><h3 id="network-security-policies">Network security policies</h3><p>Kubernetes allows for all pods to reach each other by default. You can, however, still set configuration to isolate and block traffic. Newer versions of Kubernetes also allow egress traffic to be blocked.  To do any of this, you would use a <code>NetworkPolicy</code>.  Because all traffic is allowed, it may be best to implement a policy that drops all traffic and then others to allow for specific ingress and egress traffic.</p><p>When defining a network policy, you can limit it to a namespace, with a <code>podSelector</code>, or by using labels to target the correct pods.  Further definition is for ingress to and egress from IP addresses and ports.</p><p>Not all network plugins support the <code>NetworkPolicy</code> kind.  Some that do are:</p><ul><li>Calico</li><li>Romana</li><li>Cilium</li><li>Kube-router</li><li>WeaveNet</li></ul><p>Previously, Kubernetes requires namespaces be annotated as part of the network isolation, like so: <code>net.beta.kubernetes.io/network-policy= value</code>.  While this is no longer required, some plugins may still need it.</p><p>Here is an example of a network policy definition.  The policy only affects the default namespace and pods with a <code>role=db</code> label.  Ingress and egress settings are both defined.</p><pre><code class="language-yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ingress-egress-policy
  namespace: default
spec:
  podSelector:
    matchLabels:
      role: db
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - ipBlock:
        cidr: 172.17.0.0/16
        except:
        - 172.17.1.0/24
    - namespaceSelector:
        matchLabels:
          project: myproject
    - podSelector:
        matchLabels:
          role: frontend
    ports:
    - protocol: TCP
      port: 6379
  egress:
  - to:
    - ipBlock:
        cidr: 10.0.0.0/24
    ports:
    - protocol: TCP
      port: 5978
</code></pre><p>Using empty ingress or egress rules will block traffic for the affected pods. It is not recommended you do this, but instead us a separate network policy. Some network policy recipes for different scenarios can be found <a href="https://github.com/ahmetb/kubernetes-network-policy-recipes">here on Github</a>.</p><h3 id="default-network-policy">Default network policy</h3><p>Below is an example of a network policy that does not allow ingress traffic to all pods not already matched to another policy (the <code>{}</code> does this).  All egress traffic is still allowed by this policy.</p><pre><code class="language-yaml">apiVersion: networking.k8s.io
kind: NetworkPolicy
metadata:
  name: default-deny
spec:
  podSelector: {}
  policyTypes:
  - Ingress
</code></pre><p>As policies can grow quite complex, it is often a good idea that write multiple smaller and simpler policies rather than one large complex policy.</p><h2 id="lab-exercises">Lab Exercises</h2><h3 id="lab-151---working-with-tls">Lab 15.1 - Working with TLS</h3><p>First look at the kubelet on both the cp and worker nodes.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ systemctl status kubelet.service</p></div></div><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@worker:~ $ systemctl status kubelet.service</p></div></div><p>Under the output for the cgroups, find where the configuration file can be found. It will likely be under <code>/var/lib/kubelet/config.yaml</code>.</p><p>Now take a look at the configuration file.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ sudo cat /var/lib/kubelet/config.yaml</p></div></div><p>In the output, near the end of the file, you should see a <code>staticPodPath</code> which shows where the kube-apiserver would look for pod spec.  Take a look at this directory. and some of the files within it. In the kube-controller-manager spec, notice that you can see the files referenced for the certs being used.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ sudo ls /etc/kubernetes/manifests</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ sudo cat /etc/kubernetes/manifests/kube-controller-manager.yaml</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ sudo cat /etc/kubernetes/manifests/kube-apiserver.yaml</p></div></div><p>The token for authorization are kept as secrets. Look at the secrets within the <code>kube-system</code> namespace as well as one of the secrets themselves.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl -n kube-system get secrets</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl -n kube-system get secrets certificate-controller-token-&lt;unique id&gt; -o yaml</p></div></div><p>You can use the <code>kubectl config</code> command to view and update parameters in the configuration of the cluster.  This can help prevent mistakes that accidentally remove access to the cluster. Keys and certs used are redacted from the config viewing. View some of the options for setting new credentials.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl config view</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl config set-credentials --help</p></div></div><p>Make a copy of the configuration file so that we can modify it later.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ cp $HOME/.kube/config $HOME/cluster-api-config</p></div></div><h3 id="lab-152---authentication-and-authorization">Lab 15.2 - Authentication and authorization</h3><pre><code class="language-yaml">kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: developer
  namespace: development
rules:
- apiGroups: [&quot;&quot;, &quot;extensions&quot;, &quot;apps&quot;]
  resources: [&quot;deployments&quot;, &quot;replicasets&quot;, &quot;pods&quot;]
  verbs: [&quot;list&quot;, &quot;get&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;]
</code></pre><pre><code class="language-yaml">kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: developer-role-binding
  namespace: development
subjects:
- kind: User
  name: DevDan
  apiGroup: &quot;&quot;
roleRef:
  kind: Role
  name: developer
  apiGroup: &quot;&quot;
</code></pre><h3 id="lab-153---admission-controllers">Lab 15.3 - Admission controllers</h3><p>View the existing admission controller settings.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ sudo grep admission /etc/kubernetes/manifests/kube-apiserver.yaml</p></div></div><h2 id="knowledge-check">Knowledge check</h2><ul><li><strong>Authentication</strong>, <strong>authorization</strong>, and <strong>admission control</strong> are all part of accessing the Kubernetes API</li><li>The <strong>kube-apiserver</strong> accepts and <code>--authorization-control</code> option to change the operation tool in use</li><li>You <strong>can</strong> specify egress rules in network policies</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/fundamentals/chapter15.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cka-prep/docs/fundamentals/chapter14"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Custom Resource Definitions</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cka-prep/docs/fundamentals/chapter16"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">High Availability</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#course-reading" class="table-of-contents__link toc-highlight">Course Reading</a><ul><li><a href="#learning-objectives" class="table-of-contents__link toc-highlight">Learning objectives</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#cloud-security-considerations" class="table-of-contents__link toc-highlight">Cloud security considerations</a></li><li><a href="#accessing-the-api" class="table-of-contents__link toc-highlight">Accessing the API</a></li><li><a href="#authentication" class="table-of-contents__link toc-highlight">Authentication</a></li><li><a href="#authorization" class="table-of-contents__link toc-highlight">Authorization</a></li><li><a href="#rbac-and-webhook-modes" class="table-of-contents__link toc-highlight">RBAC and webhook modes</a></li><li><a href="#admission-controller" class="table-of-contents__link toc-highlight">Admission controller</a></li><li><a href="#security-contexts" class="table-of-contents__link toc-highlight">Security contexts</a></li><li><a href="#pod-security-policies" class="table-of-contents__link toc-highlight">Pod security policies</a></li><li><a href="#network-security-policies" class="table-of-contents__link toc-highlight">Network security policies</a></li><li><a href="#default-network-policy" class="table-of-contents__link toc-highlight">Default network policy</a></li></ul></li><li><a href="#lab-exercises" class="table-of-contents__link toc-highlight">Lab Exercises</a><ul><li><a href="#lab-151---working-with-tls" class="table-of-contents__link toc-highlight">Lab 15.1 - Working with TLS</a></li><li><a href="#lab-152---authentication-and-authorization" class="table-of-contents__link toc-highlight">Lab 15.2 - Authentication and authorization</a></li><li><a href="#lab-153---admission-controllers" class="table-of-contents__link toc-highlight">Lab 15.3 - Admission controllers</a></li></ul></li><li><a href="#knowledge-check" class="table-of-contents__link toc-highlight">Knowledge check</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cka-prep/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/andrewdaoust/cka-prep" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Andrew D'Aoust. Built with Docusaurus.</div></div></div></footer></div>
<script src="/cka-prep/assets/js/runtime~main.d35ec206.js"></script>
<script src="/cka-prep/assets/js/main.57502370.js"></script>
</body>
</html>