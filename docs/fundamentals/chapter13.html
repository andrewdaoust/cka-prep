<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Logging and Troubleshooting | CKA Prep</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter13"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Logging and Troubleshooting | CKA Prep"><meta data-react-helmet="true" name="description" content="Course Reading"><meta data-react-helmet="true" property="og:description" content="Course Reading"><link data-react-helmet="true" rel="icon" href="/cka-prep/img/k8s.png"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter13"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter13" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter13" hreflang="x-default"><link rel="stylesheet" href="/cka-prep/assets/css/styles.e68b4784.css">
<link rel="preload" href="/cka-prep/assets/js/runtime~main.6dc205d5.js" as="script">
<link rel="preload" href="/cka-prep/assets/js/main.49337b95.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cka-prep/"><div class="navbar__logo"><img src="/cka-prep/img/kubernetes-icon.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/cka-prep/img/kubernetes-icon.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">CKA Prep</b></a><a class="navbar__item navbar__link navbar__link--active" href="/cka-prep/docs/intro">Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/andrewdaoust/cka-prep" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cka-prep/docs/intro">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/cka-prep/docs/fundamentals">Kubernetes Fundamentals</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes Fundamentals&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter01">Course Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter02">Basics of Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter03">Installation and Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter04">Kubernetes Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter05">APIs and Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter06">API Objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter07">Managing State with Deployments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter08">Volumes and Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter09">Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter10">Helm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter11">Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter12">Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cka-prep/docs/fundamentals/chapter13">Logging and Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter14">Custom Resource Definitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter15">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter16">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter17">Exam Domain Review</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/follow-up">Follow-up Items</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/cka-prep/docs/kubectl/setup">kubectl</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/cka-prep/docs/hard-way/about">Kubernetes the Hard Way</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/cka-prep/docs/linux">Linux</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/cka-prep/docs/misc">Miscellaneous Topics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellaneous Topics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Logging and Troubleshooting</h1></header><h2 id="course-reading">Course Reading</h2><h3 id="learning-objectives">Learning objectives</h3><ul><li>Understand Kubernetes doesn&#x27;t have integrated logging yet</li><li>Learn what external tools are used to aggregate logs</li><li>Learn basic troubleshooting flow</li><li>Discuss the use of side-cars for in-pod logs</li></ul><h3 id="overview">Overview</h3><p>Because Kubernetes depends on API calls, it is sensitive to networking issues.  Standard Linux tools can be the best for debugging issues on a cluster. If the pod you are trying to troubleshoot does not have a shell, you may need to deploy a sidecar container in that pod that has a shell to debug. DNS configuration tools like <code>dig</code> are a good start, but as issues become more complex you may need to install more powerful tools like <code>tcpdump</code>.</p><p>Large and diverse clusters have can become difficult to track, so it is essential to be able to monitor.  By monitoring we mean being able to collect the most important metrics about cluster health, like CPU, memory, and disk usage, as well as network bandwidth. Above that, we may also want to monitor the key aspects of the application deployed in the cluster.</p><p>The Metric Server can be installed on the cluster to expose a standard API which can be consumed by other agents. Once installed the endpoint can be found on the cp node at <code>/apis/metrics/k8s.io/</code>.</p><p>Logging the activity across all nodes is also not something currently built into Kubernetes. For this, something like <a href="https://www.fluentd.org/">Fluentd</a> is useful to implement a unified logging layer on the cluster.  Having an aggregated logging layer can allow for better visualization of a potential issue and gives the ability to globally search logs from the cluster.  This is a good place to start looking if networking issues aren&#x27;t the root cause.</p><p>Another options is <a href="https://prometheus.io/">Prometheus</a>, which combines logging, metrics, and alerting capabilities. Prometheus also integrates well with dashboarding tools like <a href="https://grafana.com/grafana/">Grafana</a>.</p><p>There are also a handful of very useful commands withing <code>kubectl</code> to help in troubleshooting issues across the cluster.</p><h3 id="basic-troubleshooting-steps">Basic troubleshooting steps</h3><p>Troubleshoot should start with the obvious. If there are errors coming from the command line, those should be addressed first. The symptoms of the issue will often determine the next steps if troubleshooting continues past the first things checked.  Often it is a good idea to debug from the running container as long as it has a shell that can be accessed, typically by running </p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl exec -it &lt;pod_name&gt; -- /bin/sh</p></div></div><p>If the pod is running, it is good to check the logs with </p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl logs &lt;pod_name&gt;</p></div></div><p>This will give the standard output of the running container. If you have no logs, you may want to deploy a sidecar to generate and handle logs.  </p><p>The next step would usually be networking, which would include DNS firewalls, and general connectivity.  This is done with the traditional Linux tools to debug networking issues.</p><p>If networking was not the root cause, then security may be the next thing to check. RBAC (which is discussed later), SELinux, and AppArmor are all common issues, especially with network-centric applications.</p><p>Newer Kubernetes features allow for auditing on the kube-apiserver, which is useful for viewing actions after API calls have been accepted.</p><p>In summary, the general troubleshooting flow is:</p><ul><li>Errors in the command line</li><li>Pod logs and status</li><li>Network troubleshooting in the pod&#x27;s container</li><li>Checking node logs to ensure enough resources are available</li><li>Security (RBAC, SELinux, AppArmor)</li><li>API calls to and from the API</li><li>Enable kube-apiserver auditing</li><li>Networking issues between nodes (DNS and firewall)</li><li>cp node controllers (controlling pods in a pending or errored state)</li></ul><h3 id="ephemeral-containers">Ephemeral containers</h3><p>Added in v1.16 (beta as of v1.23, and stable as of v1.25), Kubernetes allow for a container to be added to an already running pod.  This allows us to deploy a fully-featured container to an existing pod so we do not need to terminate and re-create. This is helpful, especially if the issue is intermittent or difficult to reproduce.</p><p>Ephemeral container are added via the <code>ephemeralcontainers</code> handler via API call, not via the podSpec.  Therefore, <code>kubectl edit</code> cannot be used.</p><p>Instead you could use a <code>kubectl attach</code> to join an existing process in the container.  This may be helpful instead of a <code>kubectl exec</code>.  The functionality depend on the process being attached to.</p><p>You can deploy a new ephemeral container with <code>kubectl debug</code>.</p><h3 id="cluster-start-sequence">Cluster start sequence</h3><p>Cluster startup beings with systemd (when originally built with <code>kubeadm</code>, may use another method for other initialization tools).  You can use <code>systemctl status kubelet.service</code> to see the current state and which configuration files are used to run the kubelet. The service uses the <code>/etc/systemd/kubelet.service.d/10-kubeadm.conf</code> to start-up the kubelet.</p><p>The service status shows <code>/var/lib/kubelet/config.yaml</code> as the configuration file use to set certain setting of the kubelet binary.  One important setting is the <code>staticPodPath</code> which specifies where the kubelet will ready every YAML file to start a pod.  By default it is set to <code>/etc/kubernetes/manifests/</code>.  Adding a yaml file here can be useful for troubleshooting the scheduler, as any request to the scheduler should create that pod.</p><p>Four default YAMLs start the base pods necessary for the kube-apiserver, etcd, kube-controller-manager, and kube-scheduler.</p><p>Once these four are up and running, the rest of the configured objects are created.</p><h3 id="monitoring">Monitoring</h3><p>Monitoring can be summarized as collecting metrics from the infrastructure and applications running on it.</p><p>Kubernetes used to use the now depreciated <a href="https://github.com/kubernetes-retired/heapster">Heapster</a>.  Instead, Kubernetes now has an integrated metrics server, which once set up, exposes a standard API for other agent to leverage.  Custom metrics can also be exposed and used. Once example might be an autoscaler using a custom metric to determine when a new node needs to be scaled.</p><p>Tools like Prometheus, OpenTelemetry, and Jaegar are often used for these use cases.</p><h3 id="using-krew">Using <code>krew</code></h3><p><code>kubectl</code> has the ability to be extended with plugins.  Plugins cannot override existing <code>kubectl</code> commands or add subcommands to them.  Declaration of namespace or container must come after the plugin name, for example:</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl sniff some-pod -c primary-container -n different-namespace</p></div></div><p>One of the best ways to discover and install new plugins is with <code>krew</code>, which is a plugin manager for <code>kubectl</code>.  You can find out more about installing it on the <a href="https://github.com/kubernetes-sigs/krew/"><code>krew</code> Github repo</a>.</p><p>Once installed you could run <code>kubectl krew help</code> to view the documentation on how to use <code>krew</code>.</p><p>More info about extending <code>kubectl</code> can be found in the <a href="https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/">official docs</a>.</p><p>Once <code>krew</code> is installed, make sure to add it to your <code>PATH</code></p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ export PATH=&quot;${KREW_ROOT:-$HOME/.krew}/bin:$PATH&quot;</p></div></div><table><thead><tr><th>Subcommand</th><th>Usage</th></tr></thead><tbody><tr><td><code>help</code></td><td>Explain usage of rest of commands</td></tr><tr><td><code>info</code></td><td>Shows info about <code>kubectl</code> plugin specified</td></tr><tr><td><code>install</code></td><td>Add new plugin to <code>kubectl</code></td></tr><tr><td><code>list</code></td><td>Show installed plugins</td></tr><tr><td><code>search</code></td><td>Search for new plugins</td></tr><tr><td><code>uninstall</code></td><td>Uninstall an existing plugin</td></tr><tr><td><code>update</code></td><td>Update local plugin index</td></tr><tr><td><code>upgrade</code></td><td>Upgrades local plugin index to newer version</td></tr><tr><td><code>version</code></td><td>Get version info for <code>krew</code></td></tr></tbody></table><h4 id="example-sniffing-traffic-with-wireshark">Example: Sniffing traffic with Wireshark</h4><p>Cluster network traffic is encrypted which makes debugging potential networking issues more challenging. The <code>sniff</code> plugin for <code>kubectl</code> allows you to view traffic from within. It requires Wireshark to view graphical info.</p><p><code>sniff</code> uses the first container found unless specified with the <code>-c</code> option. Here&#x27;s an example of its use:</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl sniff &lt;pod name&gt; -c &lt;container name&gt;</p></div></div><h3 id="logging-tools">Logging tools</h3><p>Logging, like monitoring, is a vast topic with many available tools.</p><p>Typically logs will be collected and aggregated locally before being ingested into some search engine.  Many software stacks exist for this purpose, with the most common being the ELK stack (Elasticsearch, Logstash, Kibana).</p><p>The kubelet writes logs to local files, which the <code>kubectl log</code> command retrieves. For cluster-wide log aggregation, something like `Fluentd can be used.  The official Kubernetes docs also describe <a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">how to architect</a> a logging solution.</p><h3 id="additional-troubleshooting-resources">Additional troubleshooting resources</h3><ul><li><a href="https://kubernetes.io/docs/tasks/debug/debug-application/">Troubleshooting applications</a></li><li><a href="https://kubernetes.io/docs/tasks/debug/debug-cluster/">Troubleshooting clusters</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues">Kubernetes issues</a></li></ul><h2 id="lab-exercises">Lab Exercises</h2><h3 id="lab-131---review-log-file-locations">Lab 13.1 - Review log file locations</h3><p>If using a systemd based cluster, you can view the node level kubelet logs with <code>journalctl</code>. Each node will have different logs as they are specific to each node.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ journalctl -u kubelet | less</p></div></div><p>Many major processes for the cluster are containerized. An example of finding and then viewing those logs for the kube-apiserver would be:</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ sudo find / -name &quot;*apiserver*log&quot;</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ sudo less &lt;path to log file&gt;</p></div></div><p>You could do something simlar to find logs for things like the kube-proxy, CoreDNS, the kube-scheduler, and other controllers.</p><p>If you are not running a systemd cluster and logs aren&#x27;t collected via systemd, then you can view the logs in the following locations on the cp node:</p><ul><li><code>/var/log/kube-apiserver.log</code> for kube-apiserver logs</li><li><code>/var/log/kube-scheduler.log</code> for kube-scheduler logs</li><li><code>/var/log/kube-controller-manager.log</code> for kube-controller-manager logs</li><li><code>/var/log/containers/</code> is the directory for any running container logs</li><li><code>/var/log/pods/</code> is the directory for any running pod logs</li></ul><p>On the worker node, you would also be able to see <code>/var/log/kubelet.log</code> and <code>/var/log/kube-proxy.log</code>.</p><h3 id="132---viewing-log-output">13.2 - Viewing log output</h3><p>To view logs from running pods you can also use <code>kubectl</code> like so:</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl get pods --all-namespaces</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl -n &lt;namespace of pod&gt; logs &lt;pod name from desired ns&gt;</p></div></div><h3 id="133---adding-tools-for-monitoring-and-metrics">13.3 - Adding tools for monitoring and metrics</h3><p>Start by cloning the metrics-server repo and viewing the <code>README</code></p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ git clone https://github.com/kubernetes-sigs/metrics-server.git</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ cd metrics-server</p><p style="margin:0px;padding:2px">ubuntu@cp:metrics-server $ cat README.md</p><p style="margin:0px;padding:2px">ubuntu@cp:metrics-server $ cd ..</p></div></div><p>Once you&#x27;ve read the README, install the required objects and verify they are there. Replace <code>latest</code> in the URL with a specific version if you need an older version.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl -n kube-system get pods</p></div></div><p>Now edit the deployment to allow for insecure TLS.  Do this by adding <code>- --kubelet-insecure-tls</code> to the end of the container args.  You may also need to add <code>- --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</code> as well. Once edited, make sure the pod is still running and not showing any errors in the logs.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl -n kube-system edit deployment metrics-server</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl -n kube-system get pods</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl -n kube-system logs &lt;metrics-server pod name&gt;</p></div></div><p>Now check that the metrics for the nods and pods. Sometimes it may take a few minutes for the metrics to populate and not throw an error.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ sleep 120</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl top pods --all-namespaces</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl top nodes</p></div></div><h4 id="configure-dashboard">Configure dashboard</h4><p>Firstly, it should be noted the dashboard is not necessarily as fully featured as the CLI, as those who develop the tooling typically use the CLI instead.</p><p>Search the artifact hub for the <code>kubernetes-dashboard</code> chart from <code>helm</code>. Edit the <code>values.yaml</code> file and change the service type to a <code>NodePort</code>. Then install the chart with the name <code>dashboard</code>.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ helm fetch kubernetes-dashboard/kubernetes-dashboard --untar</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ cd kubernetes-dashboard</p><p style="margin:0px;padding:2px">ubuntu@cp:kubernetes-dashboard $ vim values.yaml</p><p style="margin:0px;padding:2px">ubuntu@cp:kubernetes-dashboard $ helm install dashboard .</p><p style="margin:0px;padding:2px">ubuntu@cp:kubernetes-dashboard $ cd ..</p></div></div><p>We will still need to give the dashboard admin access to the rest of the cluster. In normal production cases, you&#x27;d probably not want to do this. First we&#x27;ll find the right <code>securityaccount</code> (more about these later), then create a <code>clusterrolebinding</code>.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl get serviceaccount</p><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl create clusterrolebinding dashaccess --clusterrole=cluster-admin --serviceaccount=default:dashboard-kubernetes-dashboard</p></div></div><p>Now navigate the the dashboard in your browser using the public IP of the server and the high number port (you can find this with a <code>kubectl get svc</code>).</p><p>Select the token sign-in option, you can get this from the dashboard token. Once logged in, explore the dashboard&#x27;s features.</p><div style="border-radius:10px"><div style="display:flex;background-color:#edeeef;padding:6px;border-top-left-radius:10px;border-top-right-radius:10px"><div style="background-color:#FF605C;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#FFBD44;border-radius:100%;width:10px;height:10px;margin:3px"></div><div style="background-color:#00CA4E;border-radius:100%;width:10px;height:10px;margin:3px"></div></div><div style="background-color:black;color:#00ff01;font-family:monospace;border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding-top:5px;padding-bottom:5px;padding-left:4px;margin-bottom:10px"><p style="margin:0px;padding:2px">ubuntu@cp:~ $ kubectl describe secret dashboard-kubernetes-dashboard-token-&lt;unique id&gt;</p></div></div><h2 id="knowledge-check">Knowledge check</h2><ul><li>Kubernetes does <strong>not</strong> have built-in, cluster-wide logging</li><li>If a container does not generate logs, you could use a <strong>sidecar container</strong> to generate and handle pod logging</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/fundamentals/chapter13.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cka-prep/docs/fundamentals/chapter12"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scheduling</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cka-prep/docs/fundamentals/chapter14"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Custom Resource Definitions</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#course-reading" class="table-of-contents__link toc-highlight">Course Reading</a><ul><li><a href="#learning-objectives" class="table-of-contents__link toc-highlight">Learning objectives</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#basic-troubleshooting-steps" class="table-of-contents__link toc-highlight">Basic troubleshooting steps</a></li><li><a href="#ephemeral-containers" class="table-of-contents__link toc-highlight">Ephemeral containers</a></li><li><a href="#cluster-start-sequence" class="table-of-contents__link toc-highlight">Cluster start sequence</a></li><li><a href="#monitoring" class="table-of-contents__link toc-highlight">Monitoring</a></li><li><a href="#using-krew" class="table-of-contents__link toc-highlight">Using <code>krew</code></a></li><li><a href="#logging-tools" class="table-of-contents__link toc-highlight">Logging tools</a></li><li><a href="#additional-troubleshooting-resources" class="table-of-contents__link toc-highlight">Additional troubleshooting resources</a></li></ul></li><li><a href="#lab-exercises" class="table-of-contents__link toc-highlight">Lab Exercises</a><ul><li><a href="#lab-131---review-log-file-locations" class="table-of-contents__link toc-highlight">Lab 13.1 - Review log file locations</a></li><li><a href="#132---viewing-log-output" class="table-of-contents__link toc-highlight">13.2 - Viewing log output</a></li><li><a href="#133---adding-tools-for-monitoring-and-metrics" class="table-of-contents__link toc-highlight">13.3 - Adding tools for monitoring and metrics</a></li></ul></li><li><a href="#knowledge-check" class="table-of-contents__link toc-highlight">Knowledge check</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cka-prep/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/andrewdaoust/cka-prep" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Andrew D'Aoust. Built with Docusaurus.</div></div></div></footer></div>
<script src="/cka-prep/assets/js/runtime~main.6dc205d5.js"></script>
<script src="/cka-prep/assets/js/main.49337b95.js"></script>
</body>
</html>