<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Helm | CKA Prep</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter10"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Helm | CKA Prep"><meta data-react-helmet="true" name="description" content="Course Reading"><meta data-react-helmet="true" property="og:description" content="Course Reading"><link data-react-helmet="true" rel="icon" href="/cka-prep/img/k8s.png"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter10"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter10" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/cka-prep/docs/fundamentals/chapter10" hreflang="x-default"><link rel="stylesheet" href="/cka-prep/assets/css/styles.e68b4784.css">
<link rel="preload" href="/cka-prep/assets/js/runtime~main.13d8b171.js" as="script">
<link rel="preload" href="/cka-prep/assets/js/main.d9dff869.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cka-prep/"><div class="navbar__logo"><img src="/cka-prep/img/kubernetes-icon.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/cka-prep/img/kubernetes-icon.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">CKA Prep</b></a><a class="navbar__item navbar__link navbar__link--active" href="/cka-prep/docs/intro">Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/andrewdaoust/cka-prep" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cka-prep/docs/intro">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/cka-prep/docs/fundamentals">Kubernetes Fundamentals</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes Fundamentals&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter01">Course Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter02">Basics of Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter03">Installation and Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter04">Kubernetes Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter05">APIs and Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter06">API Objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter07">Managing State with Deployments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter08">Volumes and Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter09">Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cka-prep/docs/fundamentals/chapter10">Helm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter11">Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter12">Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter13">Logging and Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter14">Custom Resource Definitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter15">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter16">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/chapter17">Exam Domain Review</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cka-prep/docs/fundamentals/follow-up">Follow-up Items</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/cka-prep/docs/kubectl/setup">kubectl</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/cka-prep/docs/hard-way/about">Kubernetes the Hard Way</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/cka-prep/docs/linux">Linux</a><button aria-label="Toggle the collapsible sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/cka-prep/docs/misc">Miscellaneous Topics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellaneous Topics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Helm</h1></header><h2 id="course-reading">Course Reading</h2><h3 id="learning-objectives">Learning objectives</h3><ul><li>Examine simple k8s deployments using Helm</li><li>Understand Chart templates used by Helm to describe what to deploy</li><li>Discuss how Tiller uses Charts to create a Deployment</li><li>Initialize Helm on a cluster</li></ul><h3 id="deploying-complex-applications">Deploying complex applications</h3><p>Helm is similar to other packages like <code>apt</code>, <code>pip</code>, or <code>npm</code>, where a chart is similar to a package in that it has binaries as well as install and uninstall scripts.</p><p>Most containerized applications have many manifests, from that of the deployment, service, and configMaps, to other objects like secrets or Ingress. All of these need a manifest. Helm comes in handy, as it packages all these manifests into a single tarball. The tarball can be put into a repo, then the repo can be searched to discover the application and then deploy it.</p><p>Tarballs can be collected into a repo for sharing, and multiple repos can be connected. Helm also allows for easy upgrade and rollback from the command line.</p><h3 id="helm-v3">Helm v3</h3><p>Helm underwent a near complete overhaul from v2 to v3.</p><p>One of the most notable changes is the removal of the need for a Tiller pod to deploy charts. This presented security issues since it needed elevated permissions to deploy. The functionality is now all built into the command, no longer needing initialization for use.</p><p>In v2, Helm did a two way strategic merge, looking at the currently applied manifest vs the one being applied and applying the updates. This did not account for any changes done outside of Helm. v3 corrects for this by also checking the current state of the live objects.</p><p>Generated names are no longer automatic in Helm v3, either one must be passed or <code>--generated-name</code> must be passed as an option.</p><h3 id="chart-contents">Chart contents</h3><p>A <strong>chart</strong> is an archived set of Kubernetes resource manifests making up a distributed application.</p><p>The basic structure of a chart is </p><pre><code>â”œâ”€â”€ Chart.yaml
â”œâ”€â”€ templates/
â””â”€â”€ values.yaml
</code></pre><p>Let&#x27;s walk through each major section.</p><p>First is the <strong><code>Chart.yaml</code></strong> file. This is basic information about the chart, like the name, version, keywords, etc.</p><p>Next is the <strong><code>values.yaml</code></strong> file. This contains the keys and values that will be used to fill in the templates to generate the release.  This is done via Go template syntax.</p><p>Finally is the <strong><code>templates</code></strong> directory. This is comprised of all the resource manifests for the application.</p><p>For more a more in-depth look at charts and their structure, including more detailed break downs of what is discussed here, as well as additional files and directories, the <a href="https://helm.sh/docs/topics/charts/">official docs</a> are a good place to look.</p><h3 id="templates">Templates</h3><p>The templates  that charts use are resource manifests that Go templating syntax. Variable from <code>values.yaml</code> are then applied in to fill in the template. </p><p>Here is an example of a template for a Kubernetes secret, defining some passwords for a MariaDB.</p><pre><code class="language-yaml">apiVersion: v1
kind: Secret
metadata:
  name: {{ template &quot;fullname&quot; . }}
  labels:
    app: {{ template &quot;fullname&quot; . }}
    chart: &quot;{{ .Chart.Name }}-{{ .Chart.Version }}&quot;
    release: &quot;{{ .Release.Name }}&quot;
    heritage: &quot;{{ .Release.Service }}&quot;
type: Opaque
data:
  mariadb-root-password: {{ default &quot;&quot; .Values.mariadbRootPassword | b64enc | quote }}
  mariadb-password: {{ default &quot;&quot; .Values.mariadbPassword | b64enc | quote }}
</code></pre><h3 id="chart-repositories-and-hub">Chart repositories and hub</h3><p>Repositories are simply HTTP servers with index file and a tarball of the present charts.</p><p>Only the <a href="https://artifacthub.io/">Artifact Hub</a> is searched unless you add additional repositories. You can search the Artifact Hub with <code>helm search hub</code>.</p><p>You can interact with repositories by using <code>helm repo</code>, like so</p><pre><code>helm repo add bitnami htâ€Œtps://charts.bitnami.com/bitnami
helm repo list
</code></pre><p>Once repos are added, charts can be searched via keywords, and then searched via the <code>helm search repo</code> command.</p><h3 id="deploying-a-chart">Deploying a chart</h3><p>Deploying charts is as easy as running a <code>helm install</code> command. Before you run this, however you may need some existing resources, like PVs for a chart&#x27;s PVCs. Currently, this information is only listed in the <code>README</code> of the chart. This can be found by downloading the tarball and expanding it to view the <code>README</code>.</p><pre><code class="language-bash">helm fetch bitnami/apache --untar
cd apache/
ls
</code></pre><p>Once a chart is installed, with Helm you can list the release, delete it, upgrade it, and roll it back.</p><p>Output for a deployment should be carefully reviewed. It will oftentimes contain information about access to the application that was deployed. If there are missing required pre-existing resources, the output is often a good place to start troubleshooting.</p><h2 id="lab-exercises">Lab Exercises</h2><h3 id="lab-101---working-with-helm-and-charts">Lab 10.1 - Working with Helm and charts</h3><p>Helm allows for simple deployment of complex configurations.  This is handy as it allows for a multi-part application to be deployed in a single step. By using a chart, the required components and their relationships are declared. A local agent, like Tiller, use the API to create object for you, effectively making Helm orchestration for orchestration.</p><p>This lab will focus on installing Helm, and then deploying a Chart to configure a MariaDB.</p><p>First we will download <code>helm</code> on the cp node and then we will set it up to use the binary. You can find all the available versions of <code>helm</code> <a href="https://github.com/helm/helm/releases/">here on Github</a>.</p><pre><code class="language-bash">wget https://get.helm.sh/helm-v3.9.4-linux-amd64.tar.gz
tar -xvf helm-v3.9.4-linux-amd64.tar.gz
sudo cp linux-amd64/helm /usr/local/bin/helm
</code></pre><p>Now that <code>helm</code> is installed, we can use it to deploy a chart. A good place to start looking at some charts is <a href="https://github.com/helm/charts/tree/master/stable">here on Github</a>. Chart can also be supplied by a vendor or you could make your own.</p><p>Let&#x27;s start using <code>helm</code> by searching the Artifact Hub for database charts.</p><pre><code class="language-bash">helm search hub database
</code></pre><p>You can add additional repos to <code>helm</code> as well. Let&#x27;s add a new repo and then deploy an echo server.</p><pre><code class="language-bash">helm repo add ealenn https://ealenn.github.io/charts
helm repo update
helm upgrade -i tester ealenn/echo-server  --debug
</code></pre><p>When using the <code>--debug</code> flag, you will get more output when resources are being created. The output usually will have information on how to access the application as well. Now let&#x27;s make sure the pod we deployed is running and then check the service.</p><pre><code class="language-bash">kubectl get pods
kubectl get svc
curl &lt;svc ClusterIP&gt;
</code></pre><p>You can view the chart history on a system with <code>helm list</code>. If you include the <code>-a</code> option, all charts, including deleted and failed, will be shown. Now let&#x27;s uninstall the echo server.</p><pre><code class="language-bash">helm uninstall tester
helm list
</code></pre><p>Now let&#x27;s find the downloaded chart tarball and then extract it to view the contents. In particular, look at the <code>values.yaml</code> file to see some of the values that could have been set.</p><pre><code class="language-bash">find $HOME -name *echo*
cd $HOME/.cache/helm/repository ; tar -xvf echo-server-*
cat echo-server/values.yaml
</code></pre><p>Values can be examined or edited before installation.  Let&#x27;s add a new repo and then download a new chart.</p><pre><code class="language-bash">helm repo add bitnami https://charts.bitnami.com/bitnami
helm fetch bitnami/apache --untar
cd apache/
</code></pre><p>Look at the <code>apache</code> chart. You&#x27;ll notice it has a similar structure. Read through the <code>values.yaml</code>.</p><pre><code class="language-bash">ls
less values.yaml
</code></pre><p>Install the chart, ensure the application is running, and then check the service is working. It may be helpful to update the <code>values.yaml</code> so that a LoadBalancer is used, instead of an autoscaler for this small lab.</p><pre><code class="language-bash">helm install anotherweb .
k get svc
curl &lt;anotherweb-apache ClusterIP&gt;
</code></pre><p>If the installation was successful, you should get a HTML response from the <code>curl</code> saying &quot;It works!&quot;.</p><p>To finish, uninstall the Helm charts. We will use <code>helm</code> again in future labs.</p><pre><code class="language-bash">helm uninstall anotherweb
</code></pre><h2 id="knowledge-check">Knowledge check</h2><ul><li>A <strong>chart</strong> is the template that describes the application to deploy, any configuration, and dependencies</li><li>Chart deployment <strong>does</strong> tell us about missing dependencies</li><li><strong>Tiller</strong> is the agent that deploys objects based on the chart</li><li>A collection of charts is called a <strong>repository</strong></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/fundamentals/chapter10.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cka-prep/docs/fundamentals/chapter09"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Services</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cka-prep/docs/fundamentals/chapter11"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ingress</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#course-reading" class="table-of-contents__link toc-highlight">Course Reading</a><ul><li><a href="#learning-objectives" class="table-of-contents__link toc-highlight">Learning objectives</a></li><li><a href="#deploying-complex-applications" class="table-of-contents__link toc-highlight">Deploying complex applications</a></li><li><a href="#helm-v3" class="table-of-contents__link toc-highlight">Helm v3</a></li><li><a href="#chart-contents" class="table-of-contents__link toc-highlight">Chart contents</a></li><li><a href="#templates" class="table-of-contents__link toc-highlight">Templates</a></li><li><a href="#chart-repositories-and-hub" class="table-of-contents__link toc-highlight">Chart repositories and hub</a></li><li><a href="#deploying-a-chart" class="table-of-contents__link toc-highlight">Deploying a chart</a></li></ul></li><li><a href="#lab-exercises" class="table-of-contents__link toc-highlight">Lab Exercises</a><ul><li><a href="#lab-101---working-with-helm-and-charts" class="table-of-contents__link toc-highlight">Lab 10.1 - Working with Helm and charts</a></li></ul></li><li><a href="#knowledge-check" class="table-of-contents__link toc-highlight">Knowledge check</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cka-prep/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/andrewdaoust/cka-prep" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Andrew D'Aoust. Built with Docusaurus.</div></div></div></footer></div>
<script src="/cka-prep/assets/js/runtime~main.13d8b171.js"></script>
<script src="/cka-prep/assets/js/main.d9dff869.js"></script>
</body>
</html>